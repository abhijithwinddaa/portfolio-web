import{u as D,e as I,r as l,s as d,j as e,X as L}from"./index-CJfiuc-8.js";import{L as w}from"./loader-circle-BYE7sdF8.js";import{A as P}from"./arrow-left-fT0_t5ia.js";import{U}from"./upload-Ch6-rikk.js";import{C as _}from"./calendar-C92eafY8.js";import{S as q}from"./save-CtBouC9b.js";const X=()=>{const{id:u}=D(),f=I(),n=!!u,[s,m]=l.useState({title:"",issuer:"",issue_date:"",expiry_date:"",credential_url:"",image_url:""}),[p,h]=l.useState(null),[g,x]=l.useState(""),[b,j]=l.useState(!1),[C,y]=l.useState(n);l.useEffect(()=>{n&&k()},[u]);const k=async()=>{try{y(!0);const{data:t,error:r}=await d.from("certificates").select("*").eq("id",u).single();if(r)throw r;t&&(m({title:t.title||"",issuer:t.issuer||"",issue_date:t.issue_date?t.issue_date.split("T")[0]:"",expiry_date:t.expiry_date?t.expiry_date.split("T")[0]:"",credential_url:t.credential_url||"",image_url:t.image_url||""}),t.image_url&&x(t.image_url))}catch(t){console.error("Error fetching certificate:",t)}finally{y(!1)}},o=t=>{const{name:r,value:a}=t.target;m(i=>({...i,[r]:a}))},F=t=>{const r=t.target.files[0];if(!r)return;if(r.size>5*1024*1024){alert("File size must be less than 5MB");return}h(r);const a=new FileReader;a.onloadend=()=>{x(a.result)},a.readAsDataURL(r)},E=()=>{h(null),x(""),m(t=>({...t,image_url:""}))},S=async t=>{t.preventDefault();try{j(!0);let r=s.image_url;if(p){const c=p.name.split(".").pop(),v=`certificate-images/${`${Date.now()}_${Math.random().toString(36).substring(2)}.${c}`}`,{error:N}=await d.storage.from("certificate-images").upload(v,p);if(N)throw N;const{data:z}=d.storage.from("certificate-images").getPublicUrl(v);r=z.publicUrl}const a={title:s.title,issuer:s.issuer,issue_date:s.issue_date||null,expiry_date:s.expiry_date||null,credential_url:s.credential_url,image_url:r};let i;if(n){const{error:c}=await d.from("certificates").update(a).eq("id",u);i=c}else{const{error:c}=await d.from("certificates").insert([{...a,created_at:new Date().toISOString()}]);i=c}if(i)throw i;f("/admin/certificates")}catch(r){console.error("Error saving certificate:",r),alert("Failed to save certificate. Please try again.")}finally{j(!1)}};return C?e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx(w,{size:30,className:"animate-spin text-purple-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>f("/admin/certificates"),className:"flex items-center text-gray-400 hover:text-white transition-colors",children:[e.jsx(P,{size:20,className:"mr-2"}),"Back to Certificates"]}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:n?"Edit Certificate":"Add New Certificate"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Certificate Image ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed border-white/10 rounded-lg",children:g?e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"relative mx-auto w-full max-w-md",children:[e.jsx("img",{src:g,alt:"Certificate preview",className:"h-64 w-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:E,className:"absolute top-2 right-2 p-1.5 bg-red-500/80 rounded-full text-white hover:bg-red-600 transition-colors",children:e.jsx(L,{size:16})})]}),e.jsx("div",{className:"text-center text-sm text-gray-400",children:"Click the X to remove the image or upload a new one"})]}):e.jsx("div",{className:"space-y-1 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"flex text-sm text-gray-400 mt-2",children:[e.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md font-medium text-purple-400 hover:text-purple-300 focus-within:outline-none",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:"image/*",onChange:F,required:!n&&!s.image_url})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF up to 5MB"})]})})})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-300",children:["Certificate Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:s.title,onChange:o,required:!0,className:"mt-1 block w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500/50 focus:ring-1 focus:ring-purple-500/30",placeholder:"Enter certificate title"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"issuer",className:"block text-sm font-medium text-gray-300",children:["Issuer ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"issuer",name:"issuer",value:s.issuer,onChange:o,required:!0,className:"mt-1 block w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500/50 focus:ring-1 focus:ring-purple-500/30",placeholder:"Enter issuing organization"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"issue_date",className:"block text-sm font-medium text-gray-300",children:"Issue Date"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_,{size:16,className:"text-gray-500"})}),e.jsx("input",{type:"date",id:"issue_date",name:"issue_date",value:s.issue_date,onChange:o,className:"block w-full pl-10 pr-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500/50 focus:ring-1 focus:ring-purple-500/30"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiry_date",className:"block text-sm font-medium text-gray-300",children:"Expiry Date (if applicable)"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_,{size:16,className:"text-gray-500"})}),e.jsx("input",{type:"date",id:"expiry_date",name:"expiry_date",value:s.expiry_date,onChange:o,className:"block w-full pl-10 pr-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500/50 focus:ring-1 focus:ring-purple-500/30"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"credential_url",className:"block text-sm font-medium text-gray-300",children:"Credential URL"}),e.jsx("input",{type:"url",id:"credential_url",name:"credential_url",value:s.credential_url,onChange:o,className:"mt-1 block w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500/50 focus:ring-1 focus:ring-purple-500/30",placeholder:"https://example.com/credential"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:b,className:"flex items-center px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg text-white font-medium hover:from-purple-600 hover:to-pink-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs(e.Fragment,{children:[e.jsx(w,{size:20,className:"mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{size:20,className:"mr-2"}),"Save Certificate"]})})})]})]})};export{X as default};
